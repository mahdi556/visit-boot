// ğŸ“‚ prisma/schema.prisma
generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "mysql"
  url      = env("DATABASE_URL")
}

// Ù…Ø¯Ù„ Ú©Ø§Ø±Ø¨Ø±Ø§Ù†
model User {
  id         Int      @id @default(autoincrement())
  username   String   @unique
  email      String   @unique
  password   String
  firstName  String
  lastName   String
  phone      String?
  role       UserRole @default(SALES_REP)
  salesRepId Int?
  isActive   Boolean  @default(true)
  createdAt  DateTime @default(now())
  updatedAt  DateTime @updatedAt

  // Ø±ÙˆØ§Ø¨Ø·
  orders       Order[]
  salesRep     SalesRep?      @relation(fields: [salesRepId], references: [id])
  PriceHistory PriceHistory[]
  ActivityLog  ActivityLog[]

  @@map("users")
}

enum UserRole {
  ADMIN
  SALES_REP
  MANAGER
}

// Ù…Ø¯Ù„ ÙØ±ÙˆØ´Ù†Ø¯Ú¯Ø§Ù†
model SalesRep {
  id        Int      @id @default(autoincrement())
  code      String   @unique
  name      String
  phone     String?
  email     String?
  isActive  Boolean  @default(true)
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  // Ø±ÙˆØ§Ø¨Ø·
  orders Order[]
  users  User[]

  @@map("sales_reps")
}

// Ù…Ø¯Ù„ Ù…Ø­ØµÙˆÙ„Ø§Øª
model Product {
  id          Int      @id @default(autoincrement())
  code        String   @unique
  name        String
  price       Float?
  category    String?
  weight      Float?
  unit        String
  description String?
  image       String?
  isActive    Boolean  @default(true)
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt

  // Ø±ÙˆØ§Ø¨Ø·
  orderItems            OrderItem[]
  pricingPlanProducts   PricingPlanProduct[]
  discountGroupProducts DiscountGroupProduct[]
  Inventory             Inventory?
  PriceHistory          PriceHistory[]

  @@map("products")
}

// Ù…Ø¯Ù„ ÙØ±ÙˆØ´Ú¯Ø§Ù‡â€ŒÙ‡Ø§
model Store {
  id        Int       @id @default(autoincrement())
  code      String    @unique
  name      String
  ownerName String?
  phone     String?
  address   String
  storeType StoreType @default(SUPERMARKET)
  latitude  Float?
  longitude Float?

  // Ø³ÛŒØ³ØªÙ… Ø§Ø¹ØªØ¨Ø§Ø±ÛŒ
  creditEnabled Boolean    @default(false)
  creditLimit   Float?
  creditDays    Int?
  creditType    CreditType @default(CASH)

  isActive  Boolean  @default(true)
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  // Ø±ÙˆØ§Ø¨Ø·
  orders             Order[]
  deliveryZone       DeliveryZone?       @relation(fields: [deliveryZoneId], references: [id])
  deliveryZoneId     Int?
  route              Route?              @relation(fields: [routeId], references: [id])
  routeId            Int?
  deliveries         Delivery[]
  creditTransactions CreditTransaction[]
  creditPayments     CreditPayment[]

  @@map("stores")
}

enum StoreType {
  SUPERMARKET
  GROCERY
  CONVENIENCE
  HYPERMARKET
  OTHER
}

// Ù…Ø¯Ù„ Ø³ÙØ§Ø±Ø´Ø§Øª
model Order {
  id            Int           @id @default(autoincrement())
  storeCode     String
  userId        Int
  salesRepId    Int?
  totalAmount   Float
  status        OrderStatus   @default(PENDING)
  notes         String?
  orderDate     DateTime      @default(now())
  deliveryDate  DateTime?
  paymentStatus PaymentStatus @default(UNPAID)
  paymentMethod OrderPaymentMethod @default(CASH)
  cashPaymentDetails Json?             
  creditDays    Int?   
  pricingPlanId Int?
  totalDiscount Float?        @default(0)
  finalAmount   Float?
  createdAt     DateTime      @default(now())
  updatedAt     DateTime      @updatedAt

  // Ø±ÙˆØ§Ø¨Ø·
  pricingPlan        PricingPlan?        @relation(fields: [pricingPlanId], references: [id])
  store              Store               @relation(fields: [storeCode], references: [code])
  user               User                @relation(fields: [userId], references: [id])
  salesRep           SalesRep?           @relation(fields: [salesRepId], references: [id])
  items              OrderItem[]
  creditTransactions CreditTransaction[]

  @@map("orders")
}

enum OrderPaymentMethod {
  CASH
  CREDIT
  CHEQUE
}

enum OrderStatus {
  PENDING
  CONFIRMED
  PREPARING
  DELIVERED
  CANCELLED
  RETURNED
}

enum PaymentStatus {
  UNPAID
  PARTIALLY_PAID
  PAID
  OVERDUE
}

// Ù…Ø¯Ù„ Ø¢ÛŒØªÙ…â€ŒÙ‡Ø§ÛŒ Ø³ÙØ§Ø±Ø´
model OrderItem {
  id          Int    @id @default(autoincrement())
  orderId     Int
  productCode String
  quantity    Int
  price       Float
  totalPrice  Float?

  // Ø±ÙˆØ§Ø¨Ø·
  order   Order   @relation(fields: [orderId], references: [id])
  product Product @relation(fields: [productCode], references: [code])

  @@map("order_items")
}

// Ù…Ø¯Ù„ Ù…Ø³ÛŒØ±Ù‡Ø§
model Route {
  id          Int      @id @default(autoincrement())
  name        String
  driverName  String?
  vehicleType String?
  color       String   @default("#6C63FF")
  isActive    Boolean  @default(true)
  coordinates Json?
  area        Float?
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt

  // Ø±ÙˆØ§Ø¨Ø·
  stores     Store[]
  deliveries Delivery[]

  @@map("routes")
}

// Ù…Ø¯Ù„ ØªØ­ÙˆÛŒÙ„â€ŒÙ‡Ø§
model Delivery {
  id           Int            @id @default(autoincrement())
  routeId      Int
  storeCode    String
  deliveryDate DateTime
  status       DeliveryStatus @default(PENDING)
  notes        String?
  createdAt    DateTime       @default(now())
  updatedAt    DateTime       @updatedAt

  // Ø±ÙˆØ§Ø¨Ø·
  route Route @relation(fields: [routeId], references: [id])
  store Store @relation(fields: [storeCode], references: [code])

  @@map("deliveries")
}

enum DeliveryStatus {
  PENDING
  IN_PROGRESS
  DELIVERED
  FAILED
  RESCHEDULED
}

// Ù…Ø¯Ù„ Ù…Ù†Ø§Ø·Ù‚ ØªØ­ÙˆÛŒÙ„
model DeliveryZone {
  id           Int      @id @default(autoincrement())
  name         String
  coordinates  Json
  deliveryCost Float
  deliveryTime Int
  color        String   @default("#6C63FF")
  area         Float?
  isActive     Boolean  @default(true)
  createdAt    DateTime @default(now())
  updatedAt    DateTime @updatedAt

  // Ø±ÙˆØ§Ø¨Ø·
  stores Store[]

  @@map("delivery_zones")
}

// Ù…Ø¯Ù„ Ù¾Ù„Ù†â€ŒÙ‡Ø§ÛŒ Ù‚ÛŒÙ…Øªâ€ŒÚ¯Ø°Ø§Ø±ÛŒ
model PricingPlan {
  id          Int       @id @default(autoincrement())
  name        String
  description String?
  isActive    Boolean   @default(true)
  startDate   DateTime
  endDate     DateTime?
  createdAt   DateTime  @default(now())
  updatedAt   DateTime  @updatedAt

  // Ø±ÙˆØ§Ø¨Ø·
  planProducts PricingPlanProduct[]
  orders       Order[]

  @@map("pricing_plans")
}

// Ù…Ø¯Ù„ Ù…Ø­ØµÙˆÙ„Ø§Øª Ù¾Ù„Ù† Ù‚ÛŒÙ…Øªâ€ŒÚ¯Ø°Ø§Ø±ÛŒ
model PricingPlanProduct {
  id            Int     @id @default(autoincrement())
  pricingPlanId Int
  productCode   String
  minQuantity   Int
  discountRate  Float   @default(0)
  description   String?

  // Ø±ÙˆØ§Ø¨Ø·
  pricingPlan PricingPlan @relation(fields: [pricingPlanId], references: [id])
  product     Product     @relation(fields: [productCode], references: [code])

  @@unique([pricingPlanId, productCode, minQuantity])
  @@map("pricing_plan_products")
}

// Ù…Ø¯Ù„ Ú¯Ø±ÙˆÙ‡â€ŒÙ‡Ø§ÛŒ ØªØ®ÙÛŒÙ
model DiscountGroup {
  id          Int      @id @default(autoincrement())
  name        String
  description String?
  isActive    Boolean  @default(true)
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt

  // Ø±ÙˆØ§Ø¨Ø·
  groupProducts DiscountGroupProduct[]
  groupTiers    DiscountGroupTier[]

  @@map("discount_groups")
}

// Ù…Ø¯Ù„ Ù…Ø­ØµÙˆÙ„Ø§Øª Ú¯Ø±ÙˆÙ‡ ØªØ®ÙÛŒÙ
model DiscountGroupProduct {
  id              Int    @id @default(autoincrement())
  discountGroupId Int
  productCode     String

  // Ø±ÙˆØ§Ø¨Ø·
  discountGroup DiscountGroup @relation(fields: [discountGroupId], references: [id])
  product       Product       @relation(fields: [productCode], references: [code])

  @@unique([discountGroupId, productCode])
  @@map("discount_group_products")
}

// Ù…Ø¯Ù„ Ø³Ø·ÙˆØ­ ØªØ®ÙÛŒÙ
model DiscountGroupTier {
  id              Int     @id @default(autoincrement())
  discountGroupId Int
  minQuantity     Int
  discountRate    Float
  description     String?

  // Ø±ÙˆØ§Ø¨Ø·
  discountGroup DiscountGroup @relation(fields: [discountGroupId], references: [id])

  @@unique([discountGroupId, minQuantity])
  @@map("discount_group_tiers")
}

// Ø³ÛŒØ³ØªÙ… Ø§Ø¹ØªØ¨Ø§Ø±ÛŒ

enum CreditType {
  CASH
  CREDIT
  CHEQUE
}

// Ù…Ø¯Ù„ ØªØ±Ø§Ú©Ù†Ø´â€ŒÙ‡Ø§ÛŒ Ø§Ø¹ØªØ¨Ø§Ø±ÛŒ
model CreditTransaction {
  id           Int                     @id @default(autoincrement())
  storeId      Int
  orderId      Int?
  amount       Float
  type         CreditTransactionType
  description  String?
  dueDate      DateTime?
  chequeNumber String?
  status       CreditTransactionStatus @default(PENDING)
  createdAt    DateTime                @default(now())
  updatedAt    DateTime                @updatedAt

  // Ø±ÙˆØ§Ø¨Ø·
  store Store  @relation(fields: [storeId], references: [id])
  order Order? @relation(fields: [orderId], references: [id])

  @@map("credit_transactions")
}

enum CreditTransactionType {
  INVOICE
  PAYMENT
  ADJUSTMENT
  CHEQUE
  REFUND
}

enum CreditTransactionStatus {
  PENDING
  PAID
  OVERDUE
  CANCELLED
  RETURNED
}

// Ù…Ø¯Ù„ Ù¾Ø±Ø¯Ø§Ø®Øªâ€ŒÙ‡Ø§ÛŒ Ø§Ø¹ØªØ¨Ø§Ø±ÛŒ
model CreditPayment {
  id            Int           @id @default(autoincrement())
  storeId       Int
  amount        Float
  paymentDate   DateTime
  paymentMethod PaymentMethod
  reference     String?
  description   String?
  createdAt     DateTime      @default(now())
  updatedAt     DateTime      @updatedAt

  // Ø±ÙˆØ§Ø¨Ø·
  store Store @relation(fields: [storeId], references: [id])

  @@map("credit_payments")
}

enum PaymentMethod {
  CASH
  CARD
  TRANSFER
  CHEQUE
  OTHER
}

// Ù…Ø¯Ù„ Ù…ÙˆØ¬ÙˆØ¯ÛŒ Ù…Ø­ØµÙˆÙ„Ø§Øª
model Inventory {
  id          Int      @id @default(autoincrement())
  productCode String
  quantity    Int      @default(0)
  minStock    Int      @default(10)
  maxStock    Int?
  location    String?
  isActive    Boolean  @default(true)
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt

  // Ø±ÙˆØ§Ø¨Ø·
  product Product @relation(fields: [productCode], references: [code])

  @@unique([productCode])
  @@map("inventory")
}

// Ù…Ø¯Ù„ ØªØ§Ø±ÛŒØ®Ú†Ù‡ Ù‚ÛŒÙ…Øªâ€ŒÙ‡Ø§
model PriceHistory {
  id          Int      @id @default(autoincrement())
  productCode String
  oldPrice    Float
  newPrice    Float
  changeDate  DateTime @default(now())
  reason      String?
  changedBy   Int

  // Ø±ÙˆØ§Ø¨Ø·
  product Product @relation(fields: [productCode], references: [code])
  user    User    @relation(fields: [changedBy], references: [id])

  @@map("price_history")
}

// Ù…Ø¯Ù„ Ù„Ø§Ú¯ ÙØ¹Ø§Ù„ÛŒØªâ€ŒÙ‡Ø§
model ActivityLog {
  id          Int      @id @default(autoincrement())
  userId      Int
  action      String
  entityType  String
  entityId    Int?
  description String?
  ipAddress   String?
  userAgent   String?
  createdAt   DateTime @default(now())

  // Ø±ÙˆØ§Ø¨Ø·
  user User @relation(fields: [userId], references: [id])

  @@map("activity_logs")
}

// Ù…Ø¯Ù„ ØªÙ†Ø¸ÛŒÙ…Ø§Øª Ø³ÛŒØ³ØªÙ…
model SystemSetting {
  id          Int      @id @default(autoincrement())
  key         String   @unique
  value       String
  description String?
  isActive    Boolean  @default(true)
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt

  @@map("system_settings")
}