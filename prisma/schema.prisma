// ğŸ“‚ prisma/schema.prisma
generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "mysql"
  url      = env("DATABASE_URL")
}

model User {
  id        Int      @id @default(autoincrement())
  username  String   @unique
  email     String   @unique
  password  String
  firstName String
  lastName  String
  phone     String?
  role      String   @default("USER")
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  orders Order[]
}

model Product {
  id          Int      @id @default(autoincrement())
  code        String   @unique
  name        String
  price       Float?
  category    String?
  weight      Float?
  unit        String
  description String?
  image       String?  // Ø§Ø¶Ø§ÙÙ‡ Ú©Ø±Ø¯Ù† ÙÛŒÙ„Ø¯ Ø¹Ú©Ø³
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt

  orderItems OrderItem[]
  pricingPlans PricingPlanProduct[]
  discountGroups DiscountGroupProduct[]
}

model Route {
  id          Int     @id @default(autoincrement())
  name        String
  driverName  String?
  vehicleType String?
  color       String  @default("#6C63FF")
  isActive    Boolean @default(true)

  coordinates Json?
  area        Float?

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  stores     Store[]
  deliveries Delivery[]
}

model Delivery {
  id           Int      @id @default(autoincrement())
  routeId      Int
  storeCode    String
  deliveryDate DateTime
  status       String   @default("PENDING")
  notes        String?
  createdAt    DateTime @default(now())
  updatedAt    DateTime @updatedAt

  route Route @relation(fields: [routeId], references: [id])
  store Store @relation(fields: [storeCode], references: [code])
}

model Store {
  id        Int      @id @default(autoincrement())
  code      String   @unique
  name      String
  ownerName String?
  phone     String?
  address   String
  storeType String   @default("SUPERMARKET")
  latitude  Float?
  longitude Float?
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  orders         Order[]
  deliveryZone   DeliveryZone? @relation(fields: [deliveryZoneId], references: [id])
  deliveryZoneId Int?
  route          Route?        @relation(fields: [routeId], references: [id])
  routeId        Int?
  deliveries     Delivery[]
}

model Order {
  id            Int      @id @default(autoincrement())
  storeCode     String
  userId        Int
  totalAmount   Float
  status        String   @default("PENDING")
  notes         String?
  orderDate     DateTime @default(now())
  createdAt     DateTime @default(now())
  updatedAt     DateTime @updatedAt
  pricingPlanId Int?
  totalDiscount Float?   @default(0)
  finalAmount   Float? // totalAmount - totalDiscount

  pricingPlan PricingPlan? @relation(fields: [pricingPlanId], references: [id])

  store Store       @relation(fields: [storeCode], references: [code])
  user  User        @relation(fields: [userId], references: [id])
  items OrderItem[]

  @@map("orders")
}

model OrderItem {
  id          Int    @id @default(autoincrement())
  orderId     Int
  productCode String
  quantity    Int
  price       Float
  totalPrice  Float?

  order   Order   @relation(fields: [orderId], references: [id])
  product Product @relation(fields: [productCode], references: [code])

  @@map("order_items")
}

model DeliveryZone {
  id           Int      @id @default(autoincrement())
  name         String
  coordinates  Json
  deliveryCost Float
  deliveryTime Int
  color        String   @default("#6C63FF")
  area         Float?
  createdAt    DateTime @default(now())
  updatedAt    DateTime @updatedAt

  stores Store[]
}

model PricingPlan {
  id          Int       @id @default(autoincrement())
  name        String
  description String?
  isActive    Boolean   @default(true)
  startDate   DateTime
  endDate     DateTime?
  createdAt   DateTime  @default(now())
  updatedAt   DateTime  @updatedAt

  planProducts PricingPlanProduct[]
  orders       Order[]
}

model PricingPlanProduct {
  id            Int     @id @default(autoincrement())
  pricingPlanId Int
  productCode   String
  minQuantity   Int
  discountRate  Float   @default(0)
  description   String?

  pricingPlan PricingPlan @relation(fields: [pricingPlanId], references: [id])
  product     Product     @relation(fields: [productCode], references: [code])

  @@unique([pricingPlanId, productCode, minQuantity])
}

// Ù…Ø¯Ù„â€ŒÙ‡Ø§ÛŒ Ø¬Ø¯ÛŒØ¯ Ø¨Ø±Ø§ÛŒ Ú¯Ø±ÙˆÙ‡â€ŒÙ‡Ø§ÛŒ ØªØ®ÙÛŒÙ
model DiscountGroup {
  id          Int      @id @default(autoincrement())
  name        String
  description String?
  isActive    Boolean  @default(true)
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt

  groupProducts DiscountGroupProduct[]
  groupTiers    DiscountGroupTier[]
}

model DiscountGroupProduct {
  id              Int    @id @default(autoincrement())
  discountGroupId Int
  productCode     String

  discountGroup DiscountGroup @relation(fields: [discountGroupId], references: [id])
  product       Product       @relation(fields: [productCode], references: [code])

  @@unique([discountGroupId, productCode])
}

model DiscountGroupTier {
  id              Int     @id @default(autoincrement())
  discountGroupId Int
  minQuantity     Int // Ø­Ø¯Ø§Ù‚Ù„ ØªØ¹Ø¯Ø§Ø¯ Ø§Ø² Ú¯Ø±ÙˆÙ‡
  discountRate    Float // Ø¯Ø±ØµØ¯ ØªØ®ÙÛŒÙ
  description     String?

  discountGroup DiscountGroup @relation(fields: [discountGroupId], references: [id])

  @@unique([discountGroupId, minQuantity])
}
